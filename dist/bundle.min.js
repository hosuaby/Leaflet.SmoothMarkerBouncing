!function(r){"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=t(r);function s(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function o(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function e(t,n,e){return n&&o(t.prototype,n),e&&o(t,e),t}function u(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function c(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&i(t,n)}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,n){return(i=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(r){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,n,e,o,i=g(r);return n=a?(t=g(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),e=this,!(o=n)||"object"!=typeof o&&"function"!=typeof o?l(e):o}}function k(t,n,e){return(k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,n,e){var o=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=g(t)););return t}(t,n);if(o){var i=Object.getOwnPropertyDescriptor(o,n);return i.get?i.get.call(e):i.value}})(t,n,e||t)}function b(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var e=[],o=!0,i=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done)&&(e.push(a.value),!n||e.length!==n);o=!0);}catch(t){i=!0,r=t}finally{try{o||null==s.return||s.return()}finally{if(i)throw r}}return e}(t,n)||a(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t){return function(t){if(Array.isArray(t))return v(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||a(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,n){if(t){if("string"==typeof t)return v(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?v(t,n):void 0}}function v(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,o=new Array(n);e<n;e++)o[e]=t[e];return o}function p(t,n){var e=n.get(t);if(!e)throw new TypeError("attempted to get private field on non-instance");return e.get?e.get.call(t):e.value}function m(t,n,e){var o=n.get(t);if(!o)throw new TypeError("attempted to set private field on non-instance");if(o.set)o.set.call(t,e);else{if(!o.writable)throw new TypeError("attempted to set read only private field");o.value=e}return e}var y=function(){function n(t){s(this,n),u(this,"bounceHeight",15),u(this,"contractHeight",12),u(this,"bounceSpeed",52),u(this,"contractSpeed",52),u(this,"shadowAngle",-Math.PI/4),u(this,"elastic",!0),u(this,"exclusive",!1),u(this,"css",!1),t&&Object.assign(this,t)}return e(n,[{key:"override",value:function(t){return Object.assign(new n(this),t)}}]),n}(),d=function(){function t(){s(this,t),u(this,"cache",{})}return e(t,[{key:"get",value:function(t,n){return this.cache[t]||(this.cache[t]=n.apply())}}]),t}(),w=/([\w-]+): ([^;]+);/g,M={transform:"transform",WebkitTransform:"-webkit-transform",OTransform:"-o-transform",MozTransform:"-moz-transform",msTransform:"-ms-transform"}[r.DomUtil.TRANSFORM],S=function(){function o(t){s(this,o),t&&Object.assign(this,t)}return e(o,[{key:"findOpacity",value:function(t){this.opacity=(null==t?void 0:t.opacityWhenUnclustered)||(null==t?void 0:t.opacity)||1}},{key:"withStyles",value:function(t){var n=new o(this);return n&&Object.assign(n,t),n}},{key:"withTransform",value:function(t){var n=new o(this);return n[M]=t,n}},{key:"toString",value:function(){return Object.entries(this).map(function(t){return"".concat(t[0],": ").concat(t[1],";")}).join(" ")}}],[{key:"parse",value:function(t){for(var n={},e=w.exec(t);e;)n[e[1]]=e[2],e=w.exec(t);return delete n["z-index"],delete n.opacity,n.outline="none",new o(n)}},{key:"ofMarker",value:function(t){var n=o.parse(t._icon.style.cssText);return n.findOpacity(t.options),n["z-index"]=t._zIndex,n}}]),o}(),_=function(){function c(t,n,e){s(this,c),u(this,"marker",void 0),u(this,"position",void 0),u(this,"bouncingOptions",void 0),u(this,"moveSteps",void 0),u(this,"moveDelays",void 0),u(this,"resizeSteps",void 0),u(this,"resizeDelays",void 0),u(this,"isBouncing",!1),u(this,"iconStyles",void 0),u(this,"shadowStyles",void 0),u(this,"bouncingAnimationPlaying",!1),this.marker=t,this.position=n,this.updateBouncingOptions(e)}return e(c,[{key:"updateBouncingOptions",value:function(t){this.bouncingOptions=t instanceof y?t:this.bouncingOptions.override(t);var n,e,o,i=this.bouncingOptions,r=i.bounceHeight,a=i.bounceSpeed,s=i.elastic;this.moveSteps=c.cache.get("moveSteps_".concat(r),function(){return c.calculateSteps(r)}),this.moveDelays=c.cache.get("moveDelays_".concat(r,"_").concat(a),function(){return c.calculateDelays(r,a)}),s&&(n=this.bouncingOptions,e=n.contractHeight,o=n.contractSpeed,this.resizeSteps=c.cache.get("resizeSteps_".concat(e),function(){return c.calculateSteps(e)}),this.resizeDelays=c.cache.get("resizeDelays_".concat(e,"_").concat(o),function(){return c.calculateDelays(e,o)})),this.recalculateMotion(this.position)}},{key:"resetStyles",value:function(t){this.iconStyles=S.ofMarker(t),t._shadow&&(this.shadowStyles=S.parse(t._shadow.style.cssText))}},{key:"recalculateMotion",value:function(t){this.position=t}},{key:"bounce",value:function(t){var n=0<arguments.length&&void 0!==t?t:null;this.bouncingAnimationPlaying?this.isBouncing=!0:(this.isBouncing=!0,this.bouncingAnimationPlaying=!0,this.move(n))}},{key:"stopBouncing",value:function(){this.isBouncing=!1}},{key:"move",value:function(t){var n=this,e=0<arguments.length&&void 0!==t?t:null;null!==e&&(--e||(this.isBouncing=!1,this.bouncingAnimationPlaying=!1));for(var o=this.moveSteps.length;o--;)setTimeout(function(t){return n.makeMoveStep(t)},this.moveDelays[o],this.moveSteps[o]);setTimeout(function(){return n.afterMove(e)},this.moveDelays[this.moveSteps.length-1])}},{key:"afterMove",value:function(t){var n=this;this.isBouncing?setTimeout(function(){return n.move(t)},this.bouncingOptions.bounceSpeed):(this.bouncingAnimationPlaying=!1,this.marker.fire("bounceend"))}},{key:"makeMoveStep",value:function(){this.marker._icon.style.cssText=this.iconStyles.toString(),this.marker._shadow&&(this.marker._shadow.style.cssText=this.shadowStyles.toString())}}],[{key:"calculateSteps",value:function(t){for(var n=1,e=[];n<=t;)e.push(n++);for(n=t;n--;)e.push(n);return e}},{key:"calculateDelays",value:function(t,n){var e=[];e[t]=n,e[0]=0;for(var o=t;--o;)e[o]=Math.round(n/(t-o));for(o=t;o--;)e.push(e[o]);for(var i=[],r=0,o=0;o<e.length;o++)r+=e[o],i.push(r);return i}}]),c}();u(_,"cache",new d);var O={a:0,b:1,c:2,d:3},T=Array(16).fill(0),x=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],B=new WeakMap,j=function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:T;s(this,a),B.set(this,{writable:!0,value:void 0}),m(this,B,f(t))}return e(a,[{key:"toFormat",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e=e.map(a.valueNameToIndex);var o=0,i=p(this,B).map(function(t,n){return n===e[o]?"'+arguments[".concat(o++,"]+'"):t}).join(",");function r(){return Function.apply(this,[i])}return i="return ' matrix3d(".concat(i,") ';"),r.prototype=Function.prototype,new r}},{key:"toString",value:function(){return" matrix3d(".concat(p(this,B).join(","),") ")}}],[{key:"zeros",value:function(){return new a}},{key:"identity",value:function(){return new a(x)}},{key:"valueNameToIndex",value:function(t){return 4*O[t[0]]+parseInt(t[1])-1}}]),a}();function z(t,n,e,o){for(var i,r=Math.round(t+Math.cos(e)*(2*o)),a=Math.round(n+Math.sin(e)*(2*o)),s=Math.abs(r-t),c=t<r?1:-1,u=Math.abs(a-n),l=n<a?1:-1,h=(u<s?s:-u)/2,f=[],v=0;f.push([t,n]),++v!==o;)-s<(i=h)&&(h-=u,t+=c),i<u&&(h+=s,n+=l);return f}var A=j.identity().toFormat("d1","d2"),P=j.identity().toFormat("b2","d1","d2"),R=function(){c(y,_);var i=h(y);function y(t,n,e){var o;return s(this,y),u(l(o=i.call(this,t,n,e)),"iconMoveTransforms",void 0),u(l(o),"iconResizeTransforms",void 0),u(l(o),"shadowMoveTransforms",void 0),u(l(o),"shadowResizeTransforms",void 0),o.recalculateMotion(n),o}return e(y,[{key:"recalculateMotion",value:function(t){var n,e,o,i,r;k(g(y.prototype),"recalculateMotion",this).call(this,t);var a,s,c,u=(null===(n=this.marker.getIcon())||void 0===n||null===(e=n.options)||void 0===e?void 0:e.iconSize[1])||(null===(o=this.marker)||void 0===o||null===(i=o._iconObj)||void 0===i||null===(r=i.options)||void 0===r?void 0:r.iconSize[1]),l=t.x,h=t.y,f=this.bouncingOptions,v=f.bounceHeight,p=f.contractHeight,m=f.shadowAngle;this.iconMoveTransforms=y.calculateIconMoveTransforms(l,h,v),this.iconResizeTransforms=y.calculateResizeTransforms(l,h,u,p),this.marker._shadow&&(this.shadowMoveTransforms=y.calculateShadowMoveTransforms(l,h,v,m),c=null===(a=this.marker.getIcon())||void 0===a||null===(s=a.options)||void 0===s?void 0:s.shadowSize[1],this.shadowResizeTransforms=y.calculateResizeTransforms(l,h,c,p))}},{key:"afterMove",value:function(t){this.bouncingOptions.elastic?this.resize(t):k(g(y.prototype),"afterMove",this).call(this,t)}},{key:"resize",value:function(t){for(var n=this,e=this.resizeSteps.length,o=e;o--;)setTimeout(function(t){return n.makeResizeStep(t)},this.resizeDelays[o],this.resizeSteps[o]);setTimeout(function(){n.isBouncing||(n.bouncingAnimationPlaying=!1)},this.resizeDelays[this.resizeSteps.length]),setTimeout(function(){n.isBouncing?n.move(t):n.marker.fire("bounceend")},this.resizeDelays[e-1])}},{key:"makeMoveStep",value:function(t){this.marker._icon.style.cssText=this.iconStyles.withTransform(this.iconMoveTransforms[t]).toString(),this.marker._shadow&&(this.marker._shadow.style.cssText=this.shadowStyles.withTransform(this.shadowMoveTransforms[t]).toString())}},{key:"makeResizeStep",value:function(t){this.marker._icon.style.cssText=this.iconStyles.withTransform(this.iconResizeTransforms[t]).toString(),this.marker._shadow&&this.bouncingOptions.shadowAngle&&(this.marker._shadow.style.cssText=this.shadowStyles.withTransform(this.shadowResizeTransforms[t]).toString())}}],[{key:"calculateIconMoveTransforms",value:function(t,n,e){for(var o=[],i=e+1;i--;)o[i]=A(t,n-i);return o}},{key:"calculateResizeTransforms",value:function(t,n,e,o){for(var i=[],r=o+1;r--;)i[r]=P((e-r)/e,t,n+r);return i}},{key:"calculateShadowMoveTransforms",value:function(t,n,e,o){var i=3<arguments.length&&void 0!==o?o:null,r=[],a=e+1,s=[];if(null!=i)s=z(t,n,i,e+1);else for(var c=0;c<=e;c++)s[c]=[t,n];for(;a--;)r[a]=A(s[a][0],s[a][1]);return r}}]),y}(),D=function(){c(a,_);var i=h(a);function a(t,n,e){var o;return s(this,a),u(l(o=i.call(this,t,n,e)),"iconMovePoints",void 0),u(l(o),"shadowMovePoints",void 0),o.recalculateMotion(n),o}return e(a,[{key:"recalculateMotion",value:function(t){k(g(a.prototype),"recalculateMotion",this).call(this,t);var n=t.x,e=t.y,o=this.bouncingOptions,i=o.bounceHeight,r=o.shadowAngle;this.iconMovePoints=a.calculateIconMovePoints(n,e,i),this.shadowMovePoints=a.calculateShadowMovePoints(n,e,i,r)}},{key:"makeMoveStep",value:function(t){k(g(a.prototype),"makeMoveStep",this).call(this,t),this.marker._icon.style.left=this.iconMovePoints[t][0]+"px",this.marker._icon.style.top=this.iconMovePoints[t][1]+"px",this.marker._shadow&&(this.marker._shadow.style.left=this.shadowMovePoints[t][0]+"px",this.marker._shadow.style.top=this.shadowMovePoints[t][1]+"px")}}],[{key:"calculateIconMovePoints",value:function(t,n,e){for(var o=e+1,i=[];o--;)i[o]=[t,n-o];return i}},{key:"calculateShadowMovePoints",value:function(t,n,e,o){if(null!=o)return z(t,n,o,e+1);for(var i=[],r=0;r<=e;r++)i[r]=[t,n];return i}}]),a}(),I=new WeakMap,E=function(){function t(){s(this,t),I.set(this,{writable:!0,value:[]})}return e(t,[{key:"getBouncingMarkers",value:function(){return p(this,I)}},{key:"addBouncingMarker",value:function(t,n){n||t._bouncingMotion.bouncingOptions.exclusive?this.stopAllBouncingMarkers():this.stopExclusiveMarkerBouncing(),p(this,I).push(t)}},{key:"stopExclusiveMarkerBouncing",value:function(){var t=p(this,I).find(function(t){return t._bouncingMotion.bouncingOptions.exclusive});t&&t.stopBouncing()}},{key:"removeBouncingMarker",value:function(t){var n=p(this,I).indexOf(t);~n&&p(this,I).splice(n,1)}},{key:"stopAllBouncingMarkers",value:function(){for(var t;t=p(this,I).shift();)t.stopBouncing()}}]),t}(),H=r.Marker.prototype._setPos,C=r.Marker.prototype.onAdd,W=r.Marker.prototype.setIcon,U={_bouncingOptions:new y,_orchestration:new E,setBouncingOptions:function(t){return this._bouncingMotion.updateBouncingOptions(t),this},isBouncing:function(){return this._bouncingMotion.isBouncing},bounce:function(t){var n=0<arguments.length&&void 0!==t?t:null;this._bouncingMotion.bounce(n);var e=this._bouncingMotion.bouncingOptions.exclusive;return r.Marker.prototype._orchestration.addBouncingMarker(this,e),this},stopBouncing:function(){return this._bouncingMotion.stopBouncing(),r.Marker.prototype._orchestration.removeBouncingMarker(this),this},toggleBouncing:function(){return this._bouncingMotion.isBouncing?this.stopBouncing():this.bounce(),this},isRealMarker:function(){return this.__proto__===r.Marker.prototype},_setPos:function(t){H.call(this,t),this.isRealMarker()&&(this._bouncingMotion.recalculateMotion(t),this._bouncingMotion.resetStyles(this))},onAdd:function(t){C.call(this,t),this.isRealMarker()&&this._bouncingMotion.resetStyles(this)},setIcon:function(t){W.call(this,t),this.isRealMarker()&&this._bouncingMotion.resetStyles(this)}};!function(t,n){void 0===n&&(n={});var e,o,i=n.insertAt;t&&"undefined"!=typeof document&&(e=document.head||document.getElementsByTagName("head")[0],(o=document.createElement("style")).type="text/css","top"===i&&e.firstChild?e.insertBefore(o,e.firstChild):e.appendChild(o),o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t)))}("@keyframes l-smooth-marker-bouncing-move {\n    from {\n        transform: translate(var(--pos-x), var(--pos-y))\n    }\n    to {\n        transform: translate(var(--pos-x-jump, var(--pos-x)), var(--pos-y-jump))\n    }\n}\n\n@keyframes l-smooth-marker-bouncing-contract {\n    from {\n        transform: translate(var(--pos-x), var(--pos-y))\n    }\n    to {\n        transform: translate(var(--pos-x), var(--pos-y-contract)) scaleY(var(--scale-contract))\n    }\n}\n\n.bouncing {\n    animation-name: l-smooth-marker-bouncing-move, l-smooth-marker-bouncing-move, l-smooth-marker-bouncing-contract, l-smooth-marker-bouncing-contract;\n    animation-direction: normal, reverse, normal, reverse;\n    animation-duration: var(--duration-jump), var(--duration-jump), var(--duration-contract), var(--duration-contract);\n    animation-delay: var(--delays)\n}\n\n.bouncing.simple {\n    animation-name: l-smooth-marker-bouncing-move, l-smooth-marker-bouncing-move;\n    animation-direction: normal, reverse;\n    animation-duration: var(--duration-jump), var(--duration-jump);\n    animation-delay: var(--delays)\n}\n");var F="l-smooth-marker-bouncing-",N=F+"contract";function L(n,t){t.forEach(function(t){return r.DomUtil.removeClass(n,t)}),n.offsetWidth,t.forEach(function(t){return r.DomUtil.addClass(n,t)})}var Y=new WeakMap,$=new WeakMap,q=new WeakMap,G=new WeakMap,J=function(){c(d,_);var i=h(d);function d(){var t;s(this,d);for(var n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return t=i.call.apply(i,[this].concat(e)),Y.set(l(t),{writable:!0,value:N}),$.set(l(t),{writable:!0,value:["bouncing"]}),q.set(l(t),{writable:!0,value:void 0}),G.set(l(t),{writable:!0,value:void 0}),t}return e(d,[{key:"updateBouncingOptions",value:function(t){k(g(d.prototype),"updateBouncingOptions",this).call(this,t),this.bouncingOptions.elastic||(m(this,Y,"l-smooth-marker-bouncing-move"),p(this,$).push("simple"))}},{key:"onAnimationEnd",value:function(t){var n=this;t.animationName===p(this,Y)&&(m(this,q,1+ +p(this,q)),m(this,q,p(this,q)%2),p(this,q)||(this.isBouncing&&(null===p(this,G)||m(this,G,p(this,G)-1))?(L(this.marker._icon,p(this,$)),L(this.marker._shadow,p(this,$))):(p(this,$).forEach(function(t){r.DomUtil.removeClass(n.marker._icon,t),r.DomUtil.removeClass(n.marker._shadow,t)}),this.bouncingAnimationPlaying=!1)))}},{key:"resetStyles",value:function(t){var n,e,o,i,r;k(g(d.prototype),"resetStyles",this).call(this,t);var a=(null===(n=this.marker.getIcon())||void 0===n||null===(e=n.options)||void 0===e?void 0:e.iconSize[1])||(null===(o=this.marker)||void 0===o||null===(i=o._iconObj)||void 0===i||null===(r=i.options)||void 0===r?void 0:r.iconSize[1]),s=d.animationParams(this.position,this.bouncingOptions,a);this.iconStyles=this.iconStyles.withStyles(s),this.marker._icon.style.cssText=this.iconStyles.toString();var c,u,l,h=this.position,f=h.x,v=h.y,p=this.bouncingOptions,m=p.bounceHeight,y=p.shadowAngle;this.marker._shadow&&y&&(u=(c=b(z(f,v,y,m+1)[m],2))[0],l=c[1],this.shadowStyles=this.shadowStyles.withStyles(s).withStyles({"--pos-x-jump":"".concat(u,"px"),"--pos-y-jump":"".concat(l,"px")}),this.marker._shadow.style.cssText=this.shadowStyles.toString())}},{key:"bounce",value:function(t){var n=this;m(this,G,0<arguments.length&&void 0!==t?t:null),m(this,q,0),this.isBouncing=!0,this.bouncingAnimationPlaying||(this.bouncingAnimationPlaying=!0,L(this.marker._icon,p(this,$)),L(this.marker._shadow,p(this,$)),this.marker._icon.addEventListener("animationend",function(t){return n.onAnimationEnd(t)}))}}],[{key:"animationParams",value:function(t,n,e){var o=t.x,i=t.y,r=n.bounceHeight,a=n.contractHeight,s=n.bounceSpeed,c=n.contractSpeed,u=d.contractScale(e,a),l=d.calculateDuration(r,s),h=d.calculateDuration(a,c),f=[0,l,2*l,2*l+h];return{"--pos-x":"".concat(o,"px"),"--pos-y":"".concat(i,"px"),"--pos-y-jump":"".concat(i-r,"px"),"--pos-y-contract":"".concat(i+a,"px"),"--scale-contract":u,"--duration-jump":"".concat(l,"ms"),"--duration-contract":"".concat(h,"ms"),"--delays":"0ms, ".concat(f[1],"ms, ").concat(f[2],"ms, ").concat(f[3],"ms")}}},{key:"contractScale",value:function(t,n){return(t-n)/t}},{key:"calculateDuration",value:function(t,n){for(var e=Math.round(.8*n),o=t;--o;)e+=Math.round(n/(t-o));return e}}]),d}();n.default.Marker.include(U),n.default.Marker.setBouncingOptions=function(t){r.Marker.prototype._bouncingOptions=t instanceof y?t:new y(t)},n.default.Marker.getBouncingMarkers=function(){r.Marker.prototype._orchestration.getBouncingMarkers()},n.default.Marker.stopAllBouncingMarkers=function(){r.Marker.prototype._orchestration.stopAllBouncingMarkers()},n.default.Marker.addInitHook(function(){var t,n,e,o;this.isRealMarker()&&(t=new y(r.Marker.prototype._bouncingOptions),this._bouncingMotion=(n=this,e=new r.Point(0,0),o=t,new(r.Browser.any3d?o.css?J:R:D)(n,e,o)))})}(L);
