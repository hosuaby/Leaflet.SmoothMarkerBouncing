!function(i){"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var e=t(i);function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function n(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function l(r){var s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e,n,o,i=g(r);return e=s?(t=g(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),n=this,!(o=e)||"object"!=typeof o&&"function"!=typeof o?u(n):o}}function m(t,e,n){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=g(t)););return t}(t,e);if(o){var i=Object.getOwnPropertyDescriptor(o,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function h(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function v(t,e){var n=e.get(t);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(t):n.value}var p=function(){function e(t){r(this,e),a(this,"bounceHeight",15),a(this,"contractHeight",12),a(this,"bounceSpeed",52),a(this,"contractSpeed",52),a(this,"shadowAngle",-Math.PI/4),a(this,"elastic",!0),a(this,"exclusive",!1),t&&Object.assign(this,t)}return n(e,[{key:"override",value:function(t){return Object.assign(new e(this),t)}}]),e}(),y=function(){function t(){r(this,t),a(this,"cache",{})}return n(t,[{key:"get",value:function(t,e){return this.cache[t]||(this.cache[t]=e.apply())}}]),t}(),d=/([\w-]+): ([^;]+);/g,k={transform:"transform",WebkitTransform:"-webkit-transform",OTransform:"-o-transform",MozTransform:"-moz-transform",msTransform:"-ms-transform"}[i.DomUtil.TRANSFORM],M=function(){function o(t){r(this,o),t&&Object.assign(this,t)}return n(o,[{key:"findOpacity",value:function(t){this.opacity=(null==t?void 0:t.opacityWhenUnclustered)||(null==t?void 0:t.opacity)||1}},{key:"withTransform",value:function(t){var e=new o(this);return e[k]=t,e}},{key:"toString",value:function(){return Object.entries(this).map(function(t){return"".concat(t[0],": ").concat(t[1],";")}).join(" ")}}],[{key:"parse",value:function(t){for(var e={},n=d.exec(t);n;)e[n[1]]=n[2],n=d.exec(t);return delete e[k],delete e["z-index"],delete e.opacity,e.outline="none",new o(e)}},{key:"ofMarker",value:function(t){var e=o.parse(t._icon.style.cssText);return e.findOpacity(t.options),e["z-index"]=t._zIndex,e}}]),o}(),b=function(){function c(t,e,n){r(this,c),a(this,"marker",void 0),a(this,"position",void 0),a(this,"bouncingOptions",void 0),a(this,"moveSteps",void 0),a(this,"moveDelays",void 0),a(this,"resizeSteps",void 0),a(this,"resizeDelays",void 0),a(this,"isBouncing",!1),a(this,"iconStyles",void 0),a(this,"shadowStyles",void 0),a(this,"bouncingAnimationPlaying",!1),this.marker=t,this.position=e,this.updateBouncingOptions(n)}return n(c,[{key:"updateBouncingOptions",value:function(t){this.bouncingOptions=t instanceof p?t:this.bouncingOptions.override(t);var e,n,o,i=this.bouncingOptions,r=i.bounceHeight,s=i.bounceSpeed,a=i.elastic;this.moveSteps=c.cache.get("moveSteps_".concat(r),function(){return c.calculateSteps(r)}),this.moveDelays=c.cache.get("moveDelays_".concat(r,"_").concat(s),function(){return c.calculateDelays(r,s)}),a&&(e=this.bouncingOptions,n=e.contractHeight,o=e.contractSpeed,this.resizeSteps=c.cache.get("resizeSteps_".concat(n),function(){return c.calculateSteps(n)}),this.resizeDelays=c.cache.get("resizeDelays_".concat(n,"_").concat(o),function(){return c.calculateDelays(n,o)})),this.recalculateMotion(this.position)}},{key:"resetStyles",value:function(t){this.iconStyles=M.ofMarker(t),t._shadow&&(this.shadowStyles=M.parse(t._shadow.style.cssText))}},{key:"recalculateMotion",value:function(t){this.position=t}},{key:"bounce",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;this.bouncingAnimationPlaying?this.isBouncing=!0:(this.isBouncing=!0,this.bouncingAnimationPlaying=!0,this.move(e))}},{key:"stopBouncing",value:function(){this.isBouncing=!1}},{key:"move",value:function(t){var e=this,n=0<arguments.length&&void 0!==t?t:null;null!==n&&(--n||(this.isBouncing=!1,this.bouncingAnimationPlaying=!1));for(var o=this.moveSteps.length;o--;)setTimeout(function(t){return e.makeMoveStep(t)},this.moveDelays[o],this.moveSteps[o]);setTimeout(function(){return e.afterMove(n)},this.moveDelays[this.moveSteps.length-1])}},{key:"afterMove",value:function(t){var e=this;this.isBouncing?setTimeout(function(){return e.move(t)},this.bouncingOptions.bounceSpeed):(this.bouncingAnimationPlaying=!1,this.marker.fire("bounceend"))}},{key:"makeMoveStep",value:function(){this.marker.isInCluster()||(this.marker._icon.style.cssText=this.iconStyles.toString(),this.marker._shadow&&(this.marker._shadow.style.cssText=this.shadowStyles.toString()))}}],[{key:"calculateSteps",value:function(t){for(var e=1,n=[];e<=t;)n.push(e++);for(e=t;e--;)n.push(e);return n}},{key:"calculateDelays",value:function(t,e){var n=[];n[t]=e,n[0]=0;for(var o=t;--o;)n[o]=Math.round(e/(t-o));for(o=t;o--;)n.push(n[o]);for(var i=[],r=0,o=0;o<n.length;o++)r+=n[o],i.push(r);return i}}]),c}();a(b,"cache",new y);var w={a:0,b:1,c:2,d:3},S=Array(16).fill(0),_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],T=new WeakMap,O=function(){function s(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:S;r(this,s),T.set(this,{writable:!0,value:void 0}),function(t,e,n){var o=e.get(t);if(!o)throw new TypeError("attempted to set private field on non-instance");if(o.set)o.set.call(t,n);else{if(!o.writable)throw new TypeError("attempted to set read only private field");o.value=n}}(this,T,h(t))}return n(s,[{key:"toFormat",value:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];n=n.map(s.valueNameToIndex);var o=0,i=v(this,T).map(function(t,e){return e===n[o]?"'+arguments[".concat(o++,"]+'"):t}).join(",");function r(){return Function.apply(this,[i])}return i="return ' matrix3d(".concat(i,") ';"),r.prototype=Function.prototype,new r}},{key:"toString",value:function(){return" matrix3d(".concat(v(this,T).join(","),") ")}}],[{key:"zeros",value:function(){return new s}},{key:"identity",value:function(){return new s(_)}},{key:"valueNameToIndex",value:function(t){return 4*w[t[0]]+parseInt(t[1])-1}}]),s}();function B(t,e,n,o){for(var i,r=Math.round(t+Math.cos(n)*(2*o)),s=Math.round(e+Math.sin(n)*(2*o)),a=Math.abs(r-t),c=t<r?1:-1,u=Math.abs(s-e),l=e<s?1:-1,h=(u<a?a:-u)/2,f=[],v=0;f.push([t,e]),++v!==o;)-a<(i=h)&&(h-=u,t+=c),i<u&&(h+=a,e+=l);return f}var z=O.identity().toFormat("d1","d2"),x=O.identity().toFormat("b2","d1","d2"),P=function(){c(d,b);var i=l(d);function d(t,e,n){var o;return r(this,d),a(u(o=i.call(this,t,e,n)),"iconMoveTransforms",void 0),a(u(o),"iconResizeTransforms",void 0),a(u(o),"shadowMoveTransforms",void 0),a(u(o),"shadowResizeTransforms",void 0),o.recalculateMotion(e),o}return n(d,[{key:"recalculateMotion",value:function(t){var e,n,o,i,r;m(g(d.prototype),"recalculateMotion",this).call(this,t);var s,a,c,u=(null===(e=this.marker.getIcon())||void 0===e||null===(n=e.options)||void 0===n?void 0:n.iconSize[1])||(null===(o=this.marker)||void 0===o||null===(i=o._iconObj)||void 0===i||null===(r=i.options)||void 0===r?void 0:r.iconSize[1]),l=t.x,h=t.y,f=this.bouncingOptions,v=f.bounceHeight,p=f.contractHeight,y=f.shadowAngle;this.iconMoveTransforms=d.calculateIconMoveTransforms(l,h,v),this.iconResizeTransforms=d.calculateIconResizeTransforms(l,h,u,p),this.marker._shadow&&(this.shadowMoveTransforms=d.calculateShadowMoveTransforms(l,h,v,y),c=null===(s=this.marker.getIcon())||void 0===s||null===(a=s.options)||void 0===a?void 0:a.shadowSize[1],this.shadowResizeTransforms=d.calculateIconResizeTransforms(l,h,c,p))}},{key:"afterMove",value:function(t){this.bouncingOptions.elastic?this.resize(t):m(g(d.prototype),"afterMove",this).call(this,t)}},{key:"resize",value:function(t){for(var e=this,n=this.resizeSteps.length,o=n;o--;)setTimeout(function(t){return e.makeResizeStep(t)},this.resizeDelays[o],this.resizeSteps[o]);setTimeout(function(){e.isBouncing||(e.bouncingAnimationPlaying=!1)},this.resizeDelays[this.resizeSteps.length]),setTimeout(function(){e.isBouncing?e.move(t):e.marker.fire("bounceend")},this.resizeDelays[n-1])}},{key:"makeMoveStep",value:function(t){this.marker.isInCluster()||(this.marker._icon.style.cssText=this.iconStyles.withTransform(this.iconMoveTransforms[t]).toString(),this.marker._shadow&&(this.marker._shadow.style.cssText=this.shadowStyles.withTransform(this.shadowMoveTransforms[t]).toString()))}},{key:"makeResizeStep",value:function(t){this.marker.isInCluster()||(this.marker._icon.style.cssText=this.iconStyles.withTransform(this.iconResizeTransforms[t]).toString(),this.marker._shadow&&this.bouncingOptions.shadowAngle&&(this.marker._shadow.style.cssText=this.shadowStyles.withTransform(this.shadowResizeTransforms[t]).toString()))}}],[{key:"calculateIconMoveTransforms",value:function(t,e,n){for(var o=[],i=n+1;i--;)o[i]=z(t,e-i);return o}},{key:"calculateIconResizeTransforms",value:function(t,e,n,o){for(var i=[],r=o+1;r--;)i[r]=x((n-r)/n,t,e+r);return i}},{key:"calculateShadowMoveTransforms",value:function(t,e,n,o){var i=3<arguments.length&&void 0!==o?o:null,r=[],s=n+1,a=[];if(null!=i)a=B(t,e,i,n+1);else for(var c=0;c<=n;c++)a[c]=[t,e];for(;s--;)r[s]=z(a[s][0],a[s][1]);return r}},{key:"calculateShadowResizeTransforms",value:function(t,e,n,o,i,r){for(var s=[],a=B(n,o,(5<arguments.length&&void 0!==r?r:null)+Math.PI,i),c=i+1;c--;)s[c]=" matrix3d("+n/a[c][0]+",0,0,0,0,"+a[c][1]/o+",0,0,0,0,1,0,"+t+","+(e+o-a[c][1])+",0,1) ";return s}}]),d}(),R=function(){c(s,b);var i=l(s);function s(t,e,n){var o;return r(this,s),a(u(o=i.call(this,t,e,n)),"iconMovePoints",void 0),a(u(o),"shadowMovePoints",void 0),o.recalculateMotion(e),o}return n(s,[{key:"recalculateMotion",value:function(t){m(g(s.prototype),"recalculateMotion",this).call(this,t);var e=t.x,n=t.y,o=this.bouncingOptions,i=o.bounceHeight,r=o.shadowAngle;this.iconMovePoints=s.calculateIconMovePoints(e,n,i),this.shadowMovePoints=s.calculateShadowMovePoints(e,n,i,r)}},{key:"makeMoveStep",value:function(t){m(g(s.prototype),"makeMoveStep",this).call(this,t),this.marker.isInCluster()||(this.marker._icon.style.left=this.iconMovePoints[t][0]+"px",this.marker._icon.style.top=this.iconMovePoints[t][1]+"px",this.marker._shadow&&(this.marker._shadow.style.left=this.shadowMovePoints[t][0]+"px",this.marker._shadow.style.top=this.shadowMovePoints[t][1]+"px"))}}],[{key:"calculateIconMovePoints",value:function(t,e,n){for(var o=n+1,i=[];o--;)i[o]=[t,e-o];return i}},{key:"calculateShadowMovePoints",value:function(t,e,n,o){if(null!=o)return B(t,e,o,n+1);for(var i=[],r=0;r<=n;r++)i[r]=[t,e];return i}}]),s}(),A=new WeakMap,I=function(){function t(){r(this,t),A.set(this,{writable:!0,value:[]})}return n(t,[{key:"getBouncingMarkers",value:function(){return v(this,A)}},{key:"addBouncingMarker",value:function(t,e){e||t._bouncingMotion.bouncingOptions.exclusive?this.stopAllBouncingMarkers():this.stopExclusiveMarkerBouncing(),v(this,A).push(t)}},{key:"stopExclusiveMarkerBouncing",value:function(){var t=v(this,A).find(function(t){return t._bouncingMotion.bouncingOptions.exclusive});t&&t.stopBouncing()}},{key:"removeBouncingMarker",value:function(t){var e=v(this,A).indexOf(t);~e&&v(this,A).splice(e,1)}},{key:"stopAllBouncingMarkers",value:function(){for(var t;t=v(this,A).shift();)t.stopBouncing()}}]),t}(),j=i.Marker.prototype._setPos,D=i.Marker.prototype.onAdd,E=i.Marker.prototype.setIcon,H={_bouncingOptions:new p,_orchestration:new I,setBouncingOptions:function(t){return this._bouncingMotion.updateBouncingOptions(t),this},isBouncing:function(){return this._bouncingMotion.isBouncing},bounce:function(t){var e=0<arguments.length&&void 0!==t?t:null;this._bouncingMotion.bounce(e);var n=this._bouncingMotion.bouncingOptions.exclusive;return i.Marker.prototype._orchestration.addBouncingMarker(this,n),this},stopBouncing:function(){return this._bouncingMotion.stopBouncing(),i.Marker.prototype._orchestration.removeBouncingMarker(this),this},toggleBouncing:function(){return this._bouncingMotion.isBouncing?this.stopBouncing():this.bounce(),this},isRealMarker:function(){return this.__proto__===i.Marker.prototype},_setPos:function(t){j.call(this,t),this.isRealMarker()&&(this._bouncingMotion.recalculateMotion(t),this._bouncingMotion.resetStyles(this))},onAdd:function(t){D.call(this,t),this.isRealMarker()&&this._bouncingMotion.resetStyles(this)},setIcon:function(t){E.call(this,t),this.isRealMarker()&&this._bouncingMotion.resetStyles(this)},isInCluster:function(){return!this._icon}};e.default.Marker.include(H),e.default.Marker.setBouncingOptions=function(t){i.Marker.prototype._bouncingOptions=t instanceof p?t:new p(t)},e.default.Marker.getBouncingMarkers=function(){i.Marker.prototype._orchestration.getBouncingMarkers()},e.default.Marker.stopAllBouncingMarkers=function(){i.Marker.prototype._orchestration.stopAllBouncingMarkers()},e.default.Marker.addInitHook(function(){var t,e,n,o;this.isRealMarker()&&(t=new p(i.Marker.prototype._bouncingOptions),this._bouncingMotion=(e=this,n=new i.Point(0,0),o=t,new(i.Browser.any3d?P:R)(e,n,o)))})}(L);
