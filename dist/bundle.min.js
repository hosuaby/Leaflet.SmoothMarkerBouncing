!function(r){"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var n=t(r);function s(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function o(t,n){for(var e=0;e<n.length;e++){var o=n[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function e(t,n,e){return n&&o(t.prototype,n),e&&o(t,e),t}function u(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function c(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&i(t,n)}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,n){return(i=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(r){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,n,e,o,i=g(r);return n=a?(t=g(this).constructor,Reflect.construct(i,arguments,t)):i.apply(this,arguments),e=this,!(o=n)||"object"!=typeof o&&"function"!=typeof o?l(e):o}}function k(t,n,e){return(k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,n,e){var o=function(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&null!==(t=g(t)););return t}(t,n);if(o){var i=Object.getOwnPropertyDescriptor(o,n);return i.get?i.get.call(e):i.value}})(t,n,e||t)}function b(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var e=[],o=!0,i=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done)&&(e.push(a.value),!n||e.length!==n);o=!0);}catch(t){i=!0,r=t}finally{try{o||null==s.return||s.return()}finally{if(i)throw r}}return e}(t,n)||function(t,n){if(!t)return;if("string"==typeof t)return a(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return a(t,n)}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,o=new Array(n);e<n;e++)o[e]=t[e];return o}function p(t,n){var e=n.get(t);if(!e)throw new TypeError("attempted to get private field on non-instance");return e.get?e.get.call(t):e.value}function f(t,n,e){var o=n.get(t);if(!o)throw new TypeError("attempted to set private field on non-instance");if(o.set)o.set.call(t,e);else{if(!o.writable)throw new TypeError("attempted to set read only private field");o.value=e}return e}var v=function(){function n(t){s(this,n),u(this,"bounceHeight",15),u(this,"contractHeight",12),u(this,"bounceSpeed",52),u(this,"contractSpeed",52),u(this,"shadowAngle",-Math.PI/4),u(this,"elastic",!0),u(this,"exclusive",!1),t&&Object.assign(this,t)}return e(n,[{key:"override",value:function(t){return Object.assign(new n(this),t)}}]),n}(),y=function(){function t(){s(this,t),u(this,"cache",{})}return e(t,[{key:"get",value:function(t,n){return this.cache[t]||(this.cache[t]=n.apply())}}]),t}(),d=/([\w-]+): ([^;]+);/g,m=function(){function o(t){s(this,o),t&&Object.assign(this,t)}return e(o,[{key:"findOpacity",value:function(t){this.opacity=(null==t?void 0:t.opacityWhenUnclustered)||(null==t?void 0:t.opacity)||1}},{key:"withStyles",value:function(t){var n=new o(this);return n&&Object.assign(n,t),n}},{key:"toString",value:function(){return Object.entries(this).map(function(t){return"".concat(t[0],": ").concat(t[1],";")}).join(" ")}}],[{key:"parse",value:function(t){for(var n={},e=d.exec(t);e;)n[e[1]]=e[2],e=d.exec(t);return delete n["z-index"],delete n.opacity,n.outline="none",new o(n)}},{key:"ofMarker",value:function(t){var n=o.parse(t._icon.style.cssText);return n.findOpacity(t.options),n["z-index"]=t._zIndex,n}}]),o}(),M=function(){function c(t,n,e){s(this,c),u(this,"marker",void 0),u(this,"position",void 0),u(this,"bouncingOptions",void 0),u(this,"moveSteps",void 0),u(this,"moveDelays",void 0),u(this,"resizeSteps",void 0),u(this,"resizeDelays",void 0),u(this,"isBouncing",!1),u(this,"iconStyles",void 0),u(this,"shadowStyles",void 0),u(this,"bouncingAnimationPlaying",!1),this.marker=t,this.position=n,this.updateBouncingOptions(e)}return e(c,[{key:"updateBouncingOptions",value:function(t){this.bouncingOptions=t instanceof v?t:this.bouncingOptions.override(t);var n,e,o,i=this.bouncingOptions,r=i.bounceHeight,a=i.bounceSpeed,s=i.elastic;this.moveSteps=c.cache.get("moveSteps_".concat(r),function(){return c.calculateSteps(r)}),this.moveDelays=c.cache.get("moveDelays_".concat(r,"_").concat(a),function(){return c.calculateDelays(r,a)}),s&&(n=this.bouncingOptions,e=n.contractHeight,o=n.contractSpeed,this.resizeSteps=c.cache.get("resizeSteps_".concat(e),function(){return c.calculateSteps(e)}),this.resizeDelays=c.cache.get("resizeDelays_".concat(e,"_").concat(o),function(){return c.calculateDelays(e,o)})),this.recalculateMotion(this.position)}},{key:"resetStyles",value:function(t){this.iconStyles=m.ofMarker(t),t._shadow&&(this.shadowStyles=m.parse(t._shadow.style.cssText))}},{key:"recalculateMotion",value:function(t){this.position=t}},{key:"bounce",value:function(t){var n=0<arguments.length&&void 0!==t?t:null;this.bouncingAnimationPlaying?this.isBouncing=!0:(this.isBouncing=!0,this.bouncingAnimationPlaying=!0,this.move(n))}},{key:"stopBouncing",value:function(){this.isBouncing=!1}},{key:"move",value:function(t){var n=this,e=0<arguments.length&&void 0!==t?t:null;null!==e&&(--e||(this.isBouncing=!1,this.bouncingAnimationPlaying=!1));for(var o=this.moveSteps.length;o--;)setTimeout(function(t){return n.makeMoveStep(t)},this.moveDelays[o],this.moveSteps[o]);setTimeout(function(){return n.afterMove(e)},this.moveDelays[this.moveSteps.length-1])}},{key:"afterMove",value:function(t){var n=this;this.isBouncing?setTimeout(function(){return n.move(t)},this.bouncingOptions.bounceSpeed):(this.bouncingAnimationPlaying=!1,this.marker.fire("bounceend"))}},{key:"makeMoveStep",value:function(){this.marker._icon.style.cssText=this.iconStyles.toString(),this.marker._shadow&&(this.marker._shadow.style.cssText=this.shadowStyles.toString())}}],[{key:"calculateSteps",value:function(t){for(var n=1,e=[];n<=t;)e.push(n++);for(n=t;n--;)e.push(n);return e}},{key:"calculateDelays",value:function(t,n){var e=[];e[t]=n,e[0]=0;for(var o=t;--o;)e[o]=Math.round(n/(t-o));for(o=t;o--;)e.push(e[o]);for(var i=[],r=0,o=0;o<e.length;o++)r+=e[o],i.push(r);return i}}]),c}();function w(t,n,e,o){for(var i,r=Math.round(t+Math.cos(e)*(2*o)),a=Math.round(n+Math.sin(e)*(2*o)),s=Math.abs(r-t),c=t<r?1:-1,u=Math.abs(a-n),l=n<a?1:-1,h=(u<s?s:-u)/2,p=[],f=0;p.push([t,n]),++f!==o;)-s<(i=h)&&(h-=u,t+=c),i<u&&(h+=s,n+=l);return p}u(M,"cache",new y);var S=function(){c(a,M);var i=h(a);function a(t,n,e){var o;return s(this,a),u(l(o=i.call(this,t,n,e)),"iconMovePoints",void 0),u(l(o),"shadowMovePoints",void 0),o.recalculateMotion(n),o}return e(a,[{key:"recalculateMotion",value:function(t){k(g(a.prototype),"recalculateMotion",this).call(this,t);var n=t.x,e=t.y,o=this.bouncingOptions,i=o.bounceHeight,r=o.shadowAngle;this.iconMovePoints=a.calculateIconMovePoints(n,e,i),this.shadowMovePoints=a.calculateShadowMovePoints(n,e,i,r)}},{key:"makeMoveStep",value:function(t){k(g(a.prototype),"makeMoveStep",this).call(this,t),this.marker._icon.style.left=this.iconMovePoints[t][0]+"px",this.marker._icon.style.top=this.iconMovePoints[t][1]+"px",this.marker._shadow&&(this.marker._shadow.style.left=this.shadowMovePoints[t][0]+"px",this.marker._shadow.style.top=this.shadowMovePoints[t][1]+"px")}}],[{key:"calculateIconMovePoints",value:function(t,n,e){for(var o=e+1,i=[];o--;)i[o]=[t,n-o];return i}},{key:"calculateShadowMovePoints",value:function(t,n,e,o){if(null!=o)return w(t,n,o,e+1);for(var i=[],r=0;r<=e;r++)i[r]=[t,n];return i}}]),a}(),_=new WeakMap,O=function(){function t(){s(this,t),_.set(this,{writable:!0,value:[]})}return e(t,[{key:"getBouncingMarkers",value:function(){return p(this,_)}},{key:"addBouncingMarker",value:function(t,n){n||t._bouncingMotion.bouncingOptions.exclusive?this.stopAllBouncingMarkers():this.stopExclusiveMarkerBouncing(),p(this,_).push(t)}},{key:"stopExclusiveMarkerBouncing",value:function(){var t=p(this,_).find(function(t){return t._bouncingMotion.bouncingOptions.exclusive});t&&t.stopBouncing()}},{key:"removeBouncingMarker",value:function(t){var n=p(this,_).indexOf(t);~n&&p(this,_).splice(n,1)}},{key:"stopAllBouncingMarkers",value:function(){for(var t;t=p(this,_).shift();)t.stopBouncing()}}]),t}(),x=r.Marker.prototype._setPos,B=r.Marker.prototype.onAdd,P=r.Marker.prototype.setIcon,j={_bouncingOptions:new v,_orchestration:new O,setBouncingOptions:function(t){return this._bouncingMotion.updateBouncingOptions(t),this},isBouncing:function(){return this._bouncingMotion.isBouncing},bounce:function(t){var n=0<arguments.length&&void 0!==t?t:null;this._bouncingMotion.bounce(n);var e=this._bouncingMotion.bouncingOptions.exclusive;return r.Marker.prototype._orchestration.addBouncingMarker(this,e),this},stopBouncing:function(){return this._bouncingMotion.stopBouncing(),r.Marker.prototype._orchestration.removeBouncingMarker(this),this},toggleBouncing:function(){return this._bouncingMotion.isBouncing?this.stopBouncing():this.bounce(),this},isRealMarker:function(){return this.__proto__===r.Marker.prototype},_setPos:function(t){x.call(this,t),this.isRealMarker()&&(this._bouncingMotion.recalculateMotion(t),this._bouncingMotion.resetStyles(this))},onAdd:function(t){B.call(this,t),this.isRealMarker()&&this._bouncingMotion.resetStyles(this)},setIcon:function(t){P.call(this,t),this.isRealMarker()&&this._bouncingMotion.resetStyles(this)}};!function(t,n){void 0===n&&(n={});var e,o,i=n.insertAt;t&&"undefined"!=typeof document&&(e=document.head||document.getElementsByTagName("head")[0],(o=document.createElement("style")).type="text/css","top"===i&&e.firstChild?e.insertBefore(o,e.firstChild):e.appendChild(o),o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t)))}("@keyframes l-smooth-marker-bouncing-move {\n    from {\n        transform: translate(var(--pos-x), var(--pos-y))\n    }\n    to {\n        transform: translate(var(--pos-x-jump, var(--pos-x)), var(--pos-y-jump))\n    }\n}\n\n@keyframes l-smooth-marker-bouncing-contract {\n    from {\n        transform: translate(var(--pos-x), var(--pos-y))\n    }\n    to {\n        transform: translate(var(--pos-x), var(--pos-y-contract)) scaleY(var(--scale-contract))\n    }\n}\n\n.bouncing {\n    animation-name: l-smooth-marker-bouncing-move, l-smooth-marker-bouncing-move, l-smooth-marker-bouncing-contract, l-smooth-marker-bouncing-contract;\n    animation-direction: normal, reverse, normal, reverse;\n    animation-duration: var(--duration-jump), var(--duration-jump), var(--duration-contract), var(--duration-contract);\n    animation-delay: var(--delays)\n}\n\n.bouncing.simple {\n    animation-name: l-smooth-marker-bouncing-move, l-smooth-marker-bouncing-move;\n    animation-direction: normal, reverse;\n    animation-duration: var(--duration-jump), var(--duration-jump);\n    animation-delay: var(--delays)\n}\n");var A="l-smooth-marker-bouncing-",D=A+"contract";function T(n,t){t.forEach(function(t){return r.DomUtil.removeClass(n,t)}),n.offsetWidth,t.forEach(function(t){return r.DomUtil.addClass(n,t)})}var E=new WeakMap,R=new WeakMap,z=new WeakMap,I=new WeakMap,C=function(){c(m,M);var i=h(m);function m(){var t;s(this,m);for(var n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return t=i.call.apply(i,[this].concat(e)),E.set(l(t),{writable:!0,value:D}),R.set(l(t),{writable:!0,value:["bouncing"]}),z.set(l(t),{writable:!0,value:void 0}),I.set(l(t),{writable:!0,value:void 0}),t}return e(m,[{key:"updateBouncingOptions",value:function(t){k(g(m.prototype),"updateBouncingOptions",this).call(this,t),this.bouncingOptions.elastic||(f(this,E,"l-smooth-marker-bouncing-move"),p(this,R).push("simple"))}},{key:"onAnimationEnd",value:function(t){var n=this;t.animationName===p(this,E)&&(f(this,z,1+ +p(this,z)),f(this,z,p(this,z)%2),p(this,z)||(this.isBouncing&&(null===p(this,I)||f(this,I,p(this,I)-1))?(T(this.marker._icon,p(this,R)),T(this.marker._shadow,p(this,R))):(p(this,R).forEach(function(t){r.DomUtil.removeClass(n.marker._icon,t),r.DomUtil.removeClass(n.marker._shadow,t)}),this.bouncingAnimationPlaying=!1)))}},{key:"resetStyles",value:function(t){var n,e,o,i,r;k(g(m.prototype),"resetStyles",this).call(this,t);var a=(null===(n=this.marker.getIcon())||void 0===n||null===(e=n.options)||void 0===e?void 0:e.iconSize[1])||(null===(o=this.marker)||void 0===o||null===(i=o._iconObj)||void 0===i||null===(r=i.options)||void 0===r?void 0:r.iconSize[1]),s=m.animationParams(this.position,this.bouncingOptions,a);this.iconStyles=this.iconStyles.withStyles(s),this.marker._icon.style.cssText=this.iconStyles.toString();var c,u,l,h=this.position,p=h.x,f=h.y,v=this.bouncingOptions,y=v.bounceHeight,d=v.shadowAngle;this.marker._shadow&&d&&(u=(c=b(w(p,f,d,y+1)[y],2))[0],l=c[1],this.shadowStyles=this.shadowStyles.withStyles(s).withStyles({"--pos-x-jump":"".concat(u,"px"),"--pos-y-jump":"".concat(l,"px")}),this.marker._shadow.style.cssText=this.shadowStyles.toString())}},{key:"bounce",value:function(t){var n=this;f(this,I,0<arguments.length&&void 0!==t?t:null),f(this,z,0),this.isBouncing=!0,this.bouncingAnimationPlaying||(this.bouncingAnimationPlaying=!0,T(this.marker._icon,p(this,R)),T(this.marker._shadow,p(this,R)),this.marker._icon.addEventListener("animationend",function(t){return n.onAnimationEnd(t)}))}}],[{key:"animationParams",value:function(t,n,e){var o=t.x,i=t.y,r=n.bounceHeight,a=n.contractHeight,s=n.bounceSpeed,c=n.contractSpeed,u=m.contractScale(e,a),l=m.calculateDuration(r,s),h=m.calculateDuration(a,c),p=[0,l,2*l,2*l+h];return{"--pos-x":"".concat(o,"px"),"--pos-y":"".concat(i,"px"),"--pos-y-jump":"".concat(i-r,"px"),"--pos-y-contract":"".concat(i+a,"px"),"--scale-contract":u,"--duration-jump":"".concat(l,"ms"),"--duration-contract":"".concat(h,"ms"),"--delays":"0ms, ".concat(p[1],"ms, ").concat(p[2],"ms, ").concat(p[3],"ms")}}},{key:"contractScale",value:function(t,n){return(t-n)/t}},{key:"calculateDuration",value:function(t,n){for(var e=Math.round(.8*n),o=t;--o;)e+=Math.round(n/(t-o));return e}}]),m}();n.default.Marker.include(j),n.default.Marker.setBouncingOptions=function(t){r.Marker.prototype._bouncingOptions=t instanceof v?t:new v(t)},n.default.Marker.getBouncingMarkers=function(){r.Marker.prototype._orchestration.getBouncingMarkers()},n.default.Marker.stopAllBouncingMarkers=function(){r.Marker.prototype._orchestration.stopAllBouncingMarkers()},n.default.Marker.addInitHook(function(){var t,n,e,o;this.isRealMarker()&&(t=new v(r.Marker.prototype._bouncingOptions),this._bouncingMotion=(n=this,e=new r.Point(0,0),o=t,new(r.Browser.any3d?C:S)(n,e,o)))})}(L);
